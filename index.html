<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“å®¶çº§ä¿¡æ¯å›¾ï¼šå…³äºç˜¦è„¸é’ˆçš„ä¸€åˆ‡ (AIå¢å¼ºç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }
        .gradient-text {
            background: linear-gradient(to right, #00A9E0, #7DBA43);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00A9E0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 gradient-text">ç˜¦è„¸é’ˆå®Œæ•´æŒ‡å—</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">åŸºäºç§‘å­¦ï¼ŒèåˆAIæ™ºèƒ½é—®ç­”ï¼Œè§£ç­”æ‚¨çš„æ‰€æœ‰ç–‘é—®ã€‚</p>
        </header>

        <main class="space-y-12">

            <section id="science" class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-8 text-[#00A9E0]">1. æ ¸å¿ƒç§‘å­¦ï¼šå®ƒå¦‚ä½•å‘æŒ¥ä½œç”¨ï¼Ÿ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="space-y-4">
                        <h3 class="text-2xl font-semibold">ä¸»è¦æˆåˆ†ï¼šAå‹è‚‰æ¯’æ†èŒæ¯’ç´ </h3>
                        <p class="text-gray-700">â€œç˜¦è„¸é’ˆâ€çš„æ ¸å¿ƒæ˜¯ä¸€ç§ç»è¿‡é«˜åº¦çº¯åŒ–çš„ç”Ÿç‰©åˆ¶å“â€”â€”Aå‹è‚‰æ¯’æ†èŒæ¯’ç´ ã€‚å®ƒå¹¶éæ¯’è¯ï¼Œè€Œæ˜¯ä¸€ç§ç²¾ç¡®ä½œç”¨äºç¥ç»çš„å¼ºæ•ˆå¤„æ–¹è¯ã€‚å®ƒé€šè¿‡æš‚æ—¶é˜»æ–­ç¥ç»å‘å’¬è‚Œä¼ é€’æ”¶ç¼©ä¿¡å·ï¼Œè®©è¿‡åº¦å‘è¾¾çš„è‚Œè‚‰å¾—ä»¥æ”¾æ¾ã€ä¼‘æ¯ï¼Œå¹¶é€æ¸è‡ªç„¶èç¼©å˜å°ï¼Œä»è€Œåœ¨è§†è§‰ä¸Šè¾¾åˆ°ç˜¦è„¸çš„æ•ˆæœã€‚</p>
                        <div class="flex items-center space-x-4 p-4 bg-blue-50 rounded-lg">
                            <span class="text-4xl">ğŸ’¡</span>
                            <p class="font-semibold">æ ¸å¿ƒåŸç†ï¼šè®©è‚Œè‚‰â€œæ”¾ä¸ªå‡â€ï¼Œè€Œéâ€œæ¶ˆé™¤â€è‚Œè‚‰ã€‚</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold text-center mb-4">æ•ˆæœæ˜¾ç°æ—¶é—´çº¿</h3>
                        <div class="relative p-4">
                            <div class="absolute left-2 top-0 bottom-0 w-1 bg-blue-100 rounded"></div>
                            <div class="relative pl-8 mb-6">
                                <div class="absolute left-0 top-1 w-5 h-5 bg-[#00A9E0] rounded-full -translate-x-1/2"></div>
                                <h4 class="font-bold">1-2 å‘¨</h4>
                                <p class="text-sm text-gray-600">å¼€å§‹æ„Ÿè§‰å’¬è‚ŒåŠ›é‡å‡å¼±ï¼Œå’€åš¼æ—¶æœ‰è½»å¾®é…¸è½¯æ„Ÿã€‚</p>
                            </div>
                            <div class="relative pl-8 mb-6">
                                <div class="absolute left-0 top-1 w-5 h-5 bg-[#00A9E0] rounded-full -translate-x-1/2"></div>
                                <h4 class="font-bold">2-4 å‘¨</h4>
                                <p class="text-sm text-gray-600">é¢éƒ¨è½®å»“å¼€å§‹å‡ºç°å¯è§çš„æ”¶çª„å˜åŒ–ã€‚</p>
                            </div>
                            <div class="relative pl-8 mb-6">
                                <div class="absolute left-0 top-1 w-5 h-5 bg-[#F7A823] rounded-full -translate-x-1/2 ring-4 ring-orange-100"></div>
                                <h4 class="font-bold">1-2 ä¸ªæœˆ</h4>
                                <p class="text-sm text-gray-600">è¾¾åˆ°æœ€ä½³ç˜¦è„¸æ•ˆæœï¼Œé¢éƒ¨çº¿æ¡æœ€ä¸ºæŸ”å’Œã€‚</p>
                            </div>
                            <div class="relative pl-8">
                                <div class="absolute left-0 top-1 w-5 h-5 bg-[#7DBA43] rounded-full -translate-x-1/2"></div>
                                <h4 class="font-bold">4-6 ä¸ªæœˆ</h4>
                                <p class="text-sm text-gray-600">æ•ˆæœé€æ¸å‡é€€ï¼Œå’¬è‚ŒåŠŸèƒ½å’Œä½“ç§¯å¼€å§‹æ¢å¤ã€‚å¯è€ƒè™‘å†æ¬¡æ²»ç–—ä»¥ç»´æŒæ•ˆæœã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="requirements" class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-8 text-[#00A9E0]">2. å¯¹ä½¿ç”¨è€…çš„è¦æ±‚ï¼šæˆ‘é€‚åˆå—ï¼Ÿ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-green-50 p-6 rounded-lg border-l-4 border-green-500">
                        <h3 class="text-2xl font-semibold mb-4 text-green-800">ç†æƒ³å€™é€‰äºº âœ…</h3>
                        <p class="mb-4">è¯¥æ²»ç–—ä»…é€‚ç”¨äºä¸€ä¸ªç‰¹å®šäººç¾¤ï¼š</p>
                        <p class="font-bold text-lg text-green-900">ç»ä¸“ä¸šåŒ»å¸ˆè¯Šæ–­ï¼Œé¢éƒ¨å®½å¤§ä¸»è¦ç”±â€œå’¬è‚Œè‚¥å¤§â€å¼•èµ·çš„ä¸ªä½“ã€‚</p>
                        <p class="mt-4 text-sm text-gray-600"><strong>è‡ªæˆ‘æ£€æŸ¥:</strong> ç”¨åŠ›å’¬ç´§ç‰™å…³ï¼Œå¦‚æœåœ¨è„¸é¢Šä¸‹é¢Œè§’å¤„èƒ½æ‘¸åˆ°ä¸€å—ç¡¬ç¡¬çš„ã€éš†èµ·çš„è‚Œè‚‰ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½å°±æ˜¯åˆé€‚çš„å€™é€‰äººã€‚</p>
                    </div>
                    <div class="bg-red-50 p-6 rounded-lg border-l-4 border-red-500">
                        <h3 class="text-2xl font-semibold mb-4 text-red-800">ç»å¯¹ç¦å¿Œç—‡ âŒ</h3>
                        <p class="mb-2">å¦‚æœæ‚¨å±äºä»¥ä¸‹ä»»ä½•ä¸€ç§æƒ…å†µï¼Œåˆ™<strong class="text-red-900">ä¸¥ç¦</strong>ä½¿ç”¨ï¼š</p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>å¦Šå¨ æœŸåŠå“ºä¹³æœŸå¥³æ€§</li>
                            <li>æ‚£æœ‰ç¥ç»è‚Œè‚‰ç–¾ç—…ï¼ˆå¦‚é‡ç—‡è‚Œæ— åŠ›ï¼‰</li>
                            <li>å¯¹è¯ç‰©ä»»ä½•æˆåˆ†è¿‡æ•</li>
                            <li>æ³¨å°„éƒ¨ä½æœ‰æ„ŸæŸ“æˆ–ç‚ç—‡</li>
                        </ul>
                    </div>
                </div>
                 <div class="mt-8 text-center p-4 bg-yellow-50 rounded-lg">
                    <p class="font-semibold text-yellow-800">âš ï¸ <span class="font-bold">é‡è¦æé†’ï¼š</span> æ³¨å°„ç˜¦è„¸é’ˆæ˜¯ä¸¥è‚ƒçš„åŒ»ç–—è¡Œä¸ºã€‚å¿…é¡»ç”±å…·å¤‡èµ„è´¨çš„ä¸“ä¸šåŒ»å¸ˆåœ¨æ­£è§„åŒ»ç–—æœºæ„ä¸­è¿›è¡Œã€‚åŒ»å¸ˆçš„ä¸“ä¸šæ€§ï¼ˆç²¾ç¡®çš„å‰‚é‡ã€ç‚¹ä½å’Œå±‚æ¬¡æ§åˆ¶ï¼‰æ˜¯å®‰å…¨å’Œæ•ˆæœçš„æ ¹æœ¬ä¿éšœã€‚</p>
                </div>
            </section>

            <section id="products" class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-2 text-[#00A9E0]">3. äº§å“è´¨é‡ï¼šå“ªä¸ªå›½å®¶æˆ–åœ°åŒºæ›´å¥½ï¼Ÿ</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">ä¸€ä¸ªäº§å“çš„â€œå›½ç±â€è¿œä¸å¦‚å…¶è·å¾—çš„â€œç­¾è¯â€é‡è¦ã€‚çœŸæ­£çš„è´¨é‡æ ‡å‡†æ˜¯çœ‹å®ƒæ˜¯å¦è·å¾—äº†å…¨çƒé¡¶çº§è¯å“ç›‘ç®¡æœºæ„ï¼ˆå¦‚ç¾å›½FDAã€æ¬§æ´²EMAã€ä¸­å›½NMPAï¼‰çš„æ‰¹å‡†ã€‚æ‰¹å‡†è¶Šå¤šï¼Œæ„å‘³ç€å…¶å®‰å…¨æ€§ã€æœ‰æ•ˆæ€§å’Œç”Ÿäº§å·¥è‰ºç»è¿‡äº†è¶Šå¹¿æ³›å’Œä¸¥æ ¼çš„ç§‘å­¦æ£€éªŒã€‚</p>
                <div class="chart-container">
                    <canvas id="brandsChart"></canvas>
                </div>
                 <p class="text-center text-sm text-gray-500 mt-4">å›¾è¡¨è§£è¯»ï¼šæ­¤å›¾åŸºäºå„å“ç‰Œè·å¾—å…¨çƒä¸‰å¤§ä¸»è¦å¸‚åœºï¼ˆç¾ã€æ¬§ã€ä¸­ï¼‰ç›‘ç®¡æœºæ„æ‰¹å‡†çš„æ•°é‡è¿›è¡Œè¯„åˆ†ã€‚åˆ†æ•°è¶Šé«˜ï¼Œä»£è¡¨å…¶å…¨çƒå‡†å…¥æ ‡å‡†å’Œè®¤å¯åº¦è¶Šé«˜ã€‚è¿™ç›´è§‚åœ°è¡¨æ˜ï¼Œæ¥è‡ªç¾å›½/çˆ±å°”å…°ã€æ³•å›½/è‹±å›½ã€å¾·å›½å’ŒéŸ©å›½çš„é¡¶å°–äº§å“å‡è¾¾åˆ°äº†å›½é™…ä¸€æµè´¨é‡æ ‡å‡†ã€‚</p>
            </section>
            
            <section id="aftercare" class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-bold text-center mb-8 text-[#00A9E0]">4. âœ¨ AIä¸ªæ€§åŒ–æœ¯åæŠ¤ç†è®¡åˆ’</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-6">å‘Šåˆ«é€šç”¨æŒ‡å—ã€‚è¾“å…¥æ‚¨çš„æ²»ç–—æ—¥æœŸï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆä¸€ä»½ä¸“å±çš„7æ—¥æŠ¤ç†è®¡åˆ’ï¼Œè®©æ‚¨çš„æ¢å¤è¿‡ç¨‹æ¸…æ™°ã€å®‰å¿ƒã€‚</p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-8">
                    <input type="date" id="treatment-date" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <button id="generate-plan-btn" class="w-full sm:w-auto bg-[#00A9E0] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#008ab4] transition-colors">ç”Ÿæˆæˆ‘çš„è®¡åˆ’</button>
                </div>
                <div id="plan-container" class="mt-6">
                    <p class="text-center text-gray-500">è¯·é€‰æ‹©æ—¥æœŸä»¥ç”Ÿæˆæ‚¨çš„ä¸ªæ€§åŒ–æŠ¤ç†è®¡åˆ’ã€‚</p>
                </div>
                <div id="plan-loader" class="hidden justify-center items-center mt-6">
                    <div class="loader"></div>
                    <p class="ml-4 text-gray-600">AIæ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸“å±è®¡åˆ’ï¼Œè¯·ç¨å€™...</p>
                </div>
            </section>
            
            <section id="conclusion" class="text-center p-8 bg-gradient-to-r from-[#00A9E0] to-[#008ab4] rounded-2xl shadow-xl">
                 <h2 class="text-3xl font-bold text-white mb-6">ç»“è®ºï¼šé€šå¾€å®‰å…¨æœ‰æ•ˆçš„ä¸‰ä¸ªæ”¯æŸ±</h2>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                     <div class="bg-white/90 p-6 rounded-lg backdrop-blur-sm">
                         <div class="text-5xl mb-4">ğŸ”¬</div>
                         <h3 class="text-xl font-bold text-gray-800">åˆè§„çš„äº§å“</h3>
                         <p class="text-gray-600 mt-2">é€‰æ‹©è·å¾—æƒå¨æœºæ„ï¼ˆFDA, EMA, NMPAï¼‰æ‰¹å‡†çš„è¯ç‰©ã€‚</p>
                     </div>
                     <div class="bg-white/90 p-6 rounded-lg backdrop-blur-sm">
                         <div class="text-5xl mb-4">ğŸ‘¨â€âš•ï¸</div>
                         <h3 class="text-xl font-bold text-gray-800">ä¸“ä¸šçš„åŒ»å¸ˆ</h3>
                         <p class="text-gray-600 mt-2">åœ¨æ­£è§„åŒ»ç–—æœºæ„ï¼Œç”±æŒè¯åŒ»å¸ˆè¿›è¡Œæ“ä½œã€‚</p>
                     </div>
                     <div class="bg-white/90 p-6 rounded-lg backdrop-blur-sm">
                         <div class="text-5xl mb-4">ğŸ™‹â€â™€ï¸</div>
                         <h3 class="text-xl font-bold text-gray-800">è´Ÿè´£ä»»çš„ä½ </h3>
                         <p class="text-gray-600 mt-2">è¯šå®å‘ŠçŸ¥ç—…å²ï¼Œå¹¶ä¸¥æ ¼éµå®ˆæœ¯åæŠ¤ç†ã€‚</p>
                     </div>
                 </div>
                 <p class="text-white mt-8 font-semibold text-lg">åœ¨ä»»ä½•åŒ»ç–—ç¾å®¹å†³ç­–ä¸­ï¼Œå®‰å…¨æ°¸è¿œæ˜¯ç¬¬ä¸€åŸåˆ™ã€‚</p>
            </section>

        </main>
        
        <footer class="text-center mt-12 py-6 border-t">
            <p class="text-sm text-gray-500">æœ¬ä¿¡æ¯å›¾å†…å®¹åŸºäºä¸“ä¸šåŒ»ç–—ç¾å®¹æŠ¥å‘Šç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»å¸ˆçš„è¯Šæ–­å’Œå»ºè®®ã€‚</p>
        </footer>

    </div>

    <!-- AI Chat Bot -->
    <button id="chat-fab" class="fixed bottom-8 right-8 bg-[#00A9E0] text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-3xl hover:bg-[#008ab4] transition-transform hover:scale-110">
        âœ¨
    </button>
    <div id="chat-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[80vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-[#00A9E0]">AIæ™ºèƒ½é—®ç­”</h3>
                <button id="close-chat-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </header>
            <main id="chat-history" class="flex-1 p-4 overflow-y-auto space-y-4">
                 <div class="flex justify-start">
                    <div class="bg-gray-100 rounded-lg p-3 max-w-lg">
                        <p>æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIå¥åº·åŠ©æ‰‹ã€‚æ‚¨å¯ä»¥é—®æˆ‘ä»»ä½•å…³äºç˜¦è„¸é’ˆçš„é—®é¢˜ã€‚ä¾‹å¦‚â€œæ²»ç–—åå¤šä¹…å¯ä»¥åŒ–å¦†ï¼Ÿâ€æˆ–â€œæœ‰å“ªäº›æ½œåœ¨çš„é£é™©ï¼Ÿâ€</p>
                    </div>
                </div>
            </main>
            <div id="chat-loader" class="hidden p-4 items-center">
                 <div class="loader !w-8 !h-8 !border-2"></div>
                 <p class="ml-3 text-sm text-gray-500">AIæ­£åœ¨æ€è€ƒä¸­...</p>
            </div>
            <footer class="p-4 border-t">
                <div class="flex gap-2">
                    <input type="text" id="chat-input" class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„é—®é¢˜...">
                    <button id="send-chat-btn" class="bg-[#00A9E0] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#008ab4]">å‘é€</button>
                </div>
            </footer>
        </div>
    </div>

    <script>
        // Chart.js initialization
        function wrapLabel(str, maxWidth) {
            if (typeof str !== 'string' || str.length <= maxWidth) {
                return str;
            }
            const words = str.split(' ');
            let lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + words[i].length + 1 < maxWidth) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        const ctx = document.getElementById('brandsChart').getContext('2d');
        const brandsData = {
            labels: [
                wrapLabel('BotoxÂ® (ç¾å›½/çˆ±å°”å…° Allergan)', 16),
                wrapLabel('DysportÂ® (æ³•å›½/è‹±å›½ Ipsen)', 16),
                wrapLabel('XeominÂ® (å¾·å›½ Merz)', 16),
                wrapLabel('LetyboÂ® (éŸ©å›½ Hugel)', 16),
                wrapLabel('HengliÂ® (ä¸­å›½ å…°å·æ‰€)', 16),
            ],
            datasets: [{
                label: 'å…¨çƒä¸»è¦å¸‚åœºæ‰¹å‡†æ•°é‡è¯„åˆ†',
                data: [3, 3, 3, 3, 1],
                backgroundColor: ['#00A9E0', '#662D8E', '#7DBA43', '#F7A823', '#F05A28'],
                borderColor: ['#008ab4', '#50246e', '#639a34', '#c7861b', '#c04820'],
                borderWidth: 2,
                borderRadius: 5,
            }]
        };

        const brandsChart = new Chart(ctx, {
            type: 'bar', data: brandsData, options: {
                responsive: true, maintainAspectRatio: false, indexAxis: 'y',
                scales: {
                    x: {
                        beginAtZero: true, max: 3,
                        ticks: {
                            stepSize: 1,
                            callback: function(value) {
                                const labels = ['æœªæ‰¹å‡†', 'NMPA', 'NMPA+FDA/EMA', 'NMPA+FDA+EMA'];
                                return labels[value];
                            }
                        },
                        grid: { color: '#E5E7EB' }
                    },
                    y: { ticks: { font: { size: 14 } }, grid: { display: false } }
                },
                plugins: {
                    legend: { display: false },
                    title: {
                        display: true, text: 'å…¨çƒä¸»æµè‚‰æ¯’æ†èŒæ¯’ç´ å“ç‰Œè´¨é‡å¯¹æ¯” (åŸºäºç›‘ç®¡æ‰¹å‡†)',
                        font: { size: 18, weight: 'bold' }, padding: { top: 10, bottom: 30 }
                    },
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0]; let label = item.chart.data.labels[item.dataIndex];
                                return Array.isArray(label) ? label.join(' ') : label;
                            },
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.x !== null) { label += `${context.parsed.x}é¡¹ä¸»è¦æ‰¹å‡†`; }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        // Gemini API Logic
        const apiKey = ""; 

        // AI Aftercare Plan Generator
        const generatePlanBtn = document.getElementById('generate-plan-btn');
        const planContainer = document.getElementById('plan-container');
        const planLoader = document.getElementById('plan-loader');
        const dateInput = document.getElementById('treatment-date');

        generatePlanBtn.addEventListener('click', async () => {
            const treatmentDate = dateInput.value;
            if (!treatmentDate) {
                planContainer.innerHTML = '<p class="text-center text-red-500">è¯·å…ˆé€‰æ‹©æ‚¨çš„æ²»ç–—æ—¥æœŸã€‚</p>';
                return;
            }
            
            planContainer.innerHTML = '';
            planLoader.style.display = 'flex';

            const schema = {
                type: "ARRAY",
                items: {
                    type: "OBJECT",
                    properties: {
                        day: { type: "STRING" },
                        title: { type: "STRING" },
                        dos: { type: "ARRAY", items: { type: "STRING" } },
                        donts: { type: "ARRAY", items: { type: "STRING" } }
                    },
                    required: ["day", "title", "dos", "donts"]
                }
            };
            
            const prompt = `åŸºäºä¸€ä¸ªæ²»ç–—æ—¥æœŸ ${treatmentDate}ï¼Œè¯·ä¸ºä¸€ä½æ¥å—äº†ç”¨äºç¼©å°å’¬è‚Œçš„è‚‰æ¯’æ†èŒæ¯’ç´ æ²»ç–—çš„æ‚£è€…ï¼Œç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„ã€ä¸ºæœŸ7å¤©çš„æœ¯åæŠ¤ç†è®¡åˆ’ã€‚è¯·ä¸¥æ ¼éµå¾ªæ ‡å‡†çš„åŒ»ç–—æœ¯åæŠ¤ç†æŒ‡å—ã€‚æ‰€æœ‰è¿”å›çš„å†…å®¹ï¼ŒåŒ…æ‹¬day, title, dos, dontsçš„å€¼ï¼Œéƒ½å¿…é¡»æ˜¯ç®€ä½“ä¸­æ–‡ã€‚è¿”å›çš„æ ¼å¼å¿…é¡»æ˜¯ç¬¦åˆæ‰€æä¾›JSON schemaçš„JSONæ•°ç»„ã€‚`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: schema
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0) {
                    const plan = JSON.parse(result.candidates[0].content.parts[0].text);
                    displayPlan(plan, treatmentDate);
                } else {
                    throw new Error("æœªèƒ½ä»APIè·å–æœ‰æ•ˆçš„è®¡åˆ’ã€‚");
                }
            } catch (error) {
                console.error('Error fetching plan:', error);
                planContainer.innerHTML = `<p class="text-center text-red-500">æŠ±æ­‰ï¼Œç”Ÿæˆè®¡åˆ’æ—¶å‘ç”Ÿé”™è¯¯ã€‚è¯·ç¨åå†è¯•ã€‚</p>`;
            } finally {
                planLoader.style.display = 'none';
            }
        });

        function displayPlan(plan, startDate) {
            let html = '<div class="space-y-4">';
            const baseDate = new Date(startDate + 'T00:00:00');

            plan.forEach((dayData, index) => {
                const currentDate = new Date(baseDate);
                currentDate.setDate(baseDate.getDate() + index);
                const dateString = `${currentDate.getMonth() + 1}æœˆ${currentDate.getDate()}æ—¥`;

                html += `
                    <div class="p-4 border rounded-lg bg-gray-50">
                        <h4 class="font-bold text-lg text-[#00A9E0]">${dayData.day} (${dateString}): ${dayData.title}</h4>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-green-600 mb-2">âœ… åº”è¯¥åš</h5>
                                <ul class="list-disc list-inside space-y-1 text-gray-700">
                                    ${dayData.dos.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-semibold text-red-600 mb-2">âŒ ä¸è¦åš</h5>
                                <ul class="list-disc list-inside space-y-1 text-gray-700">
                                    ${dayData.donts.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            planContainer.innerHTML = html;
        }

        // AI Chat Bot Logic
        const chatFab = document.getElementById('chat-fab');
        const chatModal = document.getElementById('chat-modal');
        const closeChatBtn = document.getElementById('close-chat-btn');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat-btn');
        const chatHistory = document.getElementById('chat-history');
        const chatLoader = document.getElementById('chat-loader');

        chatFab.addEventListener('click', () => chatModal.style.display = 'flex');
        closeChatBtn.addEventListener('click', () => chatModal.style.display = 'none');
        sendChatBtn.addEventListener('click', sendChatMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        async function sendChatMessage() {
            const userQuery = chatInput.value.trim();
            if (!userQuery) return;

            appendMessage(userQuery, 'user');
            chatInput.value = '';
            chatLoader.style.display = 'flex';

            const prompt = `ä½ æ˜¯ä¸€ä¸ªå…³äºâ€œç˜¦è„¸é’ˆâ€ï¼ˆç”¨äºæ²»ç–—å’¬è‚Œè‚¥å¤§çš„Aå‹è‚‰æ¯’æ†èŒæ¯’ç´ ï¼‰çš„AIå¥åº·åŠ©æ‰‹ã€‚ä½ çš„çŸ¥è¯†å®Œå…¨åŸºäºä¸€ä»½ä¸“ä¸šçš„åŒ»ç–—æŠ¥å‘Šã€‚ä½ çš„ä»»åŠ¡æ˜¯å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚è¯·ä¸¥æ ¼æ ¹æ®ä»¥ä¸‹è§„åˆ™å›ç­”ï¼š
1. ä½ çš„å›ç­”å¿…é¡»ä¸“ä¸šã€å‡†ç¡®ã€ä¸­ç«‹ã€‚
2. ä¸¥ç¦æä¾›ä»»ä½•å½¢å¼çš„åŒ»ç–—å»ºè®®æˆ–è¯Šæ–­ã€‚å¦‚æœç”¨æˆ·å¯»æ±‚åŒ»ç–—å»ºè®®ï¼Œä½ å¿…é¡»æ˜ç¡®å‘ŠçŸ¥ä»–ä»¬â€œæˆ‘ä¸èƒ½æä¾›åŒ»ç–—å»ºè®®ï¼Œè¯·å’¨è¯¢ä¸“ä¸šçš„ã€æœ‰èµ„è´¨çš„åŒ»ç”Ÿâ€ã€‚
3. ä¿æŒå›ç­”ç®€æ´æ˜äº†ã€‚
4. å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆï¼Œæˆ–è€…é—®é¢˜è¶…å‡ºäº†æŠ¥å‘ŠèŒƒå›´ï¼Œè¯·å›ç­”â€œè¿™ä¸ªé—®é¢˜è¶…å‡ºäº†æˆ‘çš„çŸ¥è¯†èŒƒå›´ï¼Œå»ºè®®æ‚¨å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿã€‚â€
ç°åœ¨ï¼Œè¯·å›ç­”ä»¥ä¸‹ç”¨æˆ·é—®é¢˜ï¼š"${userQuery}"`;
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) throw new Error('API request failed');

                const result = await response.json();
                const aiResponse = result.candidates[0].content.parts[0].text;
                appendMessage(aiResponse, 'ai');

            } catch (error) {
                console.error("Chat Error:", error);
                appendMessage("æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜ã€‚è¯·ç¨åå†è¯•ã€‚", 'ai');
            } finally {
                chatLoader.style.display = 'none';
            }
        }

        function appendMessage(text, sender) {
            const messageWrapper = document.createElement('div');
            const messageBubble = document.createElement('div');
            
            messageWrapper.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            messageBubble.className = `rounded-lg p-3 max-w-lg ${sender === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`;
            messageBubble.innerHTML = `<p>${text.replace(/\n/g, '<br>')}</p>`;
            
            messageWrapper.appendChild(messageBubble);
            chatHistory.appendChild(messageWrapper);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

    </script>
</body>
</html>
